{"version":3,"file":"index.js","sources":["../dist-src/config.js","../dist-src/util.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugin-entrypoint-alias.js","../dist-src/rollup-plugin-stats.js","../dist-src/rollup-plugin-treeshake-inputs.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/index.js"],"sourcesContent":["import path from 'path';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { validate } from 'jsonschema';\nimport merge from 'deepmerge';\nconst CONFIG_NAME = 'snowpack';\n// default settings\nconst DEFAULT_CONFIG = {\n    source: 'local',\n    dedupe: [],\n    installOptions: {\n        clean: false,\n        hash: false,\n        dest: 'web_modules',\n        exclude: ['**/__tests__/*', '**/*.@(spec|test).@(js|mjs)'],\n        externalPackage: [],\n        nomoduleOutput: 'app.nomodule.js',\n        optimize: false,\n        remoteUrl: 'https://cdn.pika.dev',\n        stat: false,\n        strict: false,\n    },\n    rollup: { plugins: [] },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        source: { type: 'string' },\n        webDependencies: { type: 'array', items: { type: 'string' } },\n        dedupe: {\n            type: 'array',\n            items: { type: 'string' },\n        },\n        namedExports: {\n            type: 'object',\n            additionalProperties: { type: 'array', items: { type: 'string' } },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                babel: { type: 'boolean' },\n                hash: { type: 'boolean' },\n                clean: { type: 'boolean' },\n                dest: { type: 'string' },\n                exclude: { type: 'array', items: { type: 'string' } },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                include: { type: 'string' },\n                nomodule: { type: 'string' },\n                nomoduleOutput: { type: 'string' },\n                optimize: { type: 'boolean' },\n                remotePackage: { type: 'array', items: { type: 'string' } },\n                remoteUrl: { type: 'string' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                stat: { type: 'boolean' },\n                strict: { type: 'boolean' },\n            },\n        },\n        rollup: {\n            type: 'object',\n            properties: {\n                plugins: { type: 'array', items: { type: 'object' } },\n            },\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const { source, help, version, ...installOptions } = flags;\n    const result = { installOptions };\n    if (source) {\n        result.source = source;\n    }\n    return result;\n}\n/** resolve --dest relative to cwd */\nfunction normalizeDest(config) {\n    config.installOptions.dest = path.resolve(process.cwd(), config.installOptions.dest);\n    return config;\n}\nexport default function loadConfig(flags) {\n    const cliConfig = expandCliFlags(flags);\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    const errors = [];\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(flags.config));\n        if (!result) {\n            errors.push(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    else {\n        // if --config not given, try searching up the file tree\n        result = explorerSync.search();\n    }\n    // no config found\n    if (!result || !result.config || result.isEmpty) {\n        // if CLI flags present, apply those as overrides\n        return {\n            config: normalizeDest(merge(DEFAULT_CONFIG, cliConfig)),\n            errors,\n        };\n    }\n    const config = result.config;\n    // validate against schema; throw helpful user if invalid\n    const validation = validate(config, configSchema, {\n        allowUnknownAttributes: false,\n        propertyName: CONFIG_NAME,\n    });\n    // if valid, apply config over defaults\n    const mergedConfig = merge(DEFAULT_CONFIG, config);\n    // if CLI flags present, apply those as overrides\n    return {\n        config: normalizeDest(merge(mergedConfig, cliConfig)),\n        errors: validation.errors.map(msg => `${path.basename(result.filepath)}: ${msg.toString()}`),\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport got from 'got';\nimport cachedir from 'cachedir';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const CACHE_DIR = cachedir('snowpack');\nexport const RESOURCE_CACHE = path.join(CACHE_DIR, 'pkg-cache-1.4');\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    fs.writeFileSync(loc, JSON.stringify(importMap, undefined, 2), { encoding: 'utf8' });\n}\nexport function fetchCDNResource(resourceUrl) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    return got(resourceUrl, {\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifest location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        if ((err.code === 'MODULE_NOT_FOUND' || err.code === 'ERR_PACKAGE_PATH_NOT_EXPORTED') &&\n            err.message.includes(`'./package.json'`)) {\n            // its most likely an export map issue, move on to our manual resolver.\n            // TODO(03-2020): Remove MODULE_NOT_FOUND check (only needed for Node v13.1-v13.9).\n        }\n        else {\n            throw err;\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.css': 'Try installing rollup-plugin-postcss and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\n","import cacache from 'cacache';\nimport PQueue from 'p-queue';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE, HAS_CDN_HASH_REGEX } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workarounds no longer needed in --source=pika mode. Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (HAS_CDN_HASH_REGEX.test(installUrl)) {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    const _pinnedUrl = headers['x-pinned-url'];\n    if (!_pinnedUrl) {\n        throw new Error('X-Pinned-URL Header expected, but none received.');\n    }\n    const pinnedUrl = `${PIKA_CDN}${_pinnedUrl}`;\n    await cacache.put(RESOURCE_CACHE, installUrl, body, {\n        metadata: { pinnedUrl },\n    });\n    return pinnedUrl;\n}\nexport async function resolveTargetsFromRemoteCDN(installTargets, lockfile, pkgManifest, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    const allInstallSpecifiers = new Set(installTargets.map(dep => dep.specifier));\n    for (const installSpecifier of allInstallSpecifiers) {\n        const installSemver = (pkgManifest.dependencies || {})[installSpecifier] ||\n            (pkgManifest.devDependencies || {})[installSpecifier] ||\n            (pkgManifest.peerDependencies || {})[installSpecifier] ||\n            'latest';\n        downloadQueue.add(async () => {\n            const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n            if (resolvedUrl) {\n                newLockfile.imports[installSpecifier] = resolvedUrl;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    return newLockfile;\n}\nexport function clearCache() {\n    return cacache.rm.all(RESOURCE_CACHE);\n}\n","import cacache from 'cacache';\nimport { RESOURCE_CACHE, fetchCDNResource, PIKA_CDN, HAS_CDN_HASH_REGEX } from './util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ log }) {\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDN path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(source);\n            if (HAS_CDN_HASH_REGEX.test(source)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body);\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locally instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = source.substring(3).split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then(resolved => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            return cachedResult.data.toString('utf8');\n        },\n    };\n}\n","import path from 'path';\nimport { resolveDependencyManifest } from './util';\nconst IS_DEEP_PACKAGE_IMPORT = /^(@[\\w-]+\\/)?([\\w-]+)\\/(.*)/;\n/**\n * rollup-plugin-entrypoint-alias\n *\n * Aliases any deep imports from a package to the package name, so that\n * chunking can happen more accurately.\n *\n * Example: lit-element imports from both 'lit-html' & 'lit-html/lit-html.js'.\n * Even though both eventually resolve to the same place, without this plugin\n * we lose the ability to mark \"lit-html\" as an external package.\n */\nexport function rollupPluginEntrypointAlias({ cwd }) {\n    return {\n        name: 'snowpack:rollup-plugin-entrypoint-alias',\n        resolveId(source, importer) {\n            if (!IS_DEEP_PACKAGE_IMPORT.test(source)) {\n                return null;\n            }\n            const [, packageScope, packageName] = source.match(IS_DEEP_PACKAGE_IMPORT);\n            const packageFullName = packageScope ? `${packageScope}${packageName}` : packageName;\n            const [, manifest] = resolveDependencyManifest(packageFullName, cwd);\n            if (!manifest) {\n                return null;\n            }\n            let needsAlias = (typeof manifest.module === 'string' &&\n                source === path.posix.join(packageFullName, manifest.module)) ||\n                (typeof manifest.browser === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.browser)) ||\n                (typeof manifest.main === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.main));\n            if (!needsAlias) {\n                return null;\n            }\n            return this.resolve(packageFullName, importer, { skipSelf: true }).then(resolved => {\n                return resolved || null;\n            });\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync(contents).byteLength,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw) ? raw : Buffer.from(raw, 'utf8');\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import path from 'path';\n/**\n * rollup-plugin-treeshake-inputs\n *\n * How it works:\n * 1. An array of \"install targets\" are passed in, describing all known imports + metadata.\n * 2. Known imports are marked for tree-shaking by appending 'pika-treeshake:' to the input value.\n * 3. On load, we return a false virtual file for all \"pika-treeshake:\" inputs.\n *    a. That virtual file contains only `export ... from 'ACTUAL_FILE_PATH';` exports\n *    b. Rollup uses those exports to drive its tree-shaking algorithm.\n */\nexport function rollupPluginTreeshakeInputs(allImports) {\n    const installTargetsByFile = {};\n    return {\n        name: 'snowpack:treeshake-inputs',\n        // Mark some inputs for tree-shaking.\n        options(inputOptions) {\n            const input = inputOptions.input;\n            for (const [key, val] of Object.entries(input)) {\n                installTargetsByFile[val] = allImports.filter(imp => imp.specifier === key);\n                // If an input has known install targets, and none of those have \"all=true\", mark for treeshaking.\n                if (installTargetsByFile[val].length > 0 &&\n                    !installTargetsByFile[val].some(imp => imp.all)) {\n                    input[key] = `pika-treeshake:${val}`;\n                }\n            }\n            return inputOptions;\n        },\n        resolveId(source) {\n            if (source.startsWith('pika-treeshake:')) {\n                return source;\n            }\n            return null;\n        },\n        load(id) {\n            if (!id.startsWith('pika-treeshake:')) {\n                return null;\n            }\n            const fileLoc = id.substring('pika-treeshake:'.length);\n            // Reduce all install targets into a single \"summarized\" install target.\n            const treeshakeSummary = installTargetsByFile[fileLoc].reduce((summary, imp) => {\n                summary.default = summary.default || imp.default;\n                summary.namespace = summary.namespace || imp.namespace;\n                summary.named = [...summary.named, ...imp.named];\n                return summary;\n            });\n            const uniqueNamedImports = new Set(treeshakeSummary.named);\n            const normalizedFileLoc = fileLoc.split(path.win32.sep).join(path.posix.sep);\n            const result = `\n        ${treeshakeSummary.namespace ? `export * from '${normalizedFileLoc}';` : ''}\n        ${treeshakeSummary.default\n                ? `import __pika_web_default_export_for_treeshaking__ from '${normalizedFileLoc}'; export default __pika_web_default_export_for_treeshaking__;`\n                : ''}\n        ${`export {${[...uniqueNamedImports].join(',')}} from '${normalizedFileLoc}';`}\n      `;\n            return result;\n        },\n    };\n}\n","import nodePath from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport validatePackageName from 'validate-npm-package-name';\nimport { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport { isTruthy } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst SPLIT_NAMED_IMPORTS_REGEX = /\\bas\\s+\\w+|,/s;\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    if (imp.d > -1) {\n        return code.substring(imp.s + 1, imp.e - 1);\n    }\n    return code.substring(imp.s, imp.e);\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the “.js”\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    const dynamicImport = imp.d > -1;\n    const defaultImport = !dynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const namespaceImport = !dynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(SPLIT_NAMED_IMPORTS_REGEX)\n        .map(name => name.trim())\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: dynamicImport,\n        default: defaultImport,\n        namespace: namespaceImport,\n        named: namedImports,\n    };\n}\nfunction getInstallTargetsForFile(filePath, code) {\n    const [imports] = parse(code) || [];\n    const allImports = imports\n        .map(imp => parseImportStatement(code, imp))\n        .filter(isTruthy);\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n    return depList\n        .map(whitelistItem => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports({ include, exclude }) {\n    await initESModuleLexer;\n    const includeFiles = glob.sync(include, { ignore: exclude, nodir: true });\n    if (!includeFiles.length) {\n        console.warn(`[SCAN ERROR]: No files matching \"${include}\"`);\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    return includeFiles\n        .filter(filePath => filePath.endsWith('.js') ||\n        filePath.endsWith('mjs') ||\n        filePath.endsWith('.ts') ||\n        filePath.endsWith('.tsx'))\n        .map(filePath => [filePath, fs.readFileSync(filePath, 'utf8')])\n        .map(([filePath, code]) => getInstallTargetsForFile(filePath, code))\n        .reduce((flat, item) => flat.concat(item), [])\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier));\n}\n","import chalk from 'chalk';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return chalk[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return chalk[color](`Δ ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = chalk.dim(isLastFile ? '└─' : '├─');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = chalk.dim('[') + formatDelta(stats.delta) + chalk.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  ⦿ ${chalk.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            chalk.bold.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  ⦿ ${chalk.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import babelPresetEnv from '@babel/preset-env';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport hasha from 'hasha';\nimport isNodeBuiltin from 'is-builtin-module';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport rollupPluginBabel from 'rollup-plugin-babel';\nimport { terser as rollupPluginTerser } from 'rollup-plugin-terser';\nimport validatePackageName from 'validate-npm-package-name';\nimport yargs from 'yargs-parser';\nimport loadConfig from './config.js';\nimport { resolveTargetsFromRemoteCDN, clearCache } from './resolve-remote.js';\nimport { rollupPluginDependencyCache } from './rollup-plugin-remote-cdn.js';\nimport { rollupPluginEntrypointAlias } from './rollup-plugin-entrypoint-alias.js';\nimport { rollupPluginDependencyStats } from './rollup-plugin-stats.js';\nimport { rollupPluginTreeshakeInputs } from './rollup-plugin-treeshake-inputs.js';\nimport { scanDepList, scanImports } from './scan-imports.js';\nimport { printStats } from './stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, readLockfile, resolveDependencyManifest, writeLockfile, } from './util.js';\nconst ALWAYS_SHOW_ERRORS = new Set(['react', 'react-dom']);\nconst cwd = process.cwd();\nconst banner = chalk.bold(`snowpack`) + ` installing... `;\nconst installResults = [];\nlet dependencyStats = null;\nlet spinner = ora(banner);\nlet spinnerHasError = false;\nfunction printHelp() {\n    console.log(`\n${chalk.bold(`snowpack`)} - Install npm dependencies to run natively on the web.\n${chalk.bold('Options:')}\n  --dest [path]             Specify destination directory (default: \"web_modules/\").\n  --clean                   Clear out the destination directory before install.\n  --optimize                Transpile, minify, and optimize installed dependencies for production.\n  --babel                   Transpile installed dependencies. Also enabled with \"--optimize\".\n  --include [glob]          Auto-detect imports from file(s). Supports glob.\n  --exclude [glob]          Exclude files from --include. Follows glob’s ignore pattern.\n  --config [path]           Location of Snowpack config file.\n  --strict                  Only install pure ESM dependency trees. Fail if a CJS module is encountered.\n  --no-source-map           Skip emitting source map files (.js.map) into dest\n  --stat                    Logs install statistics after installing, with information on install targets and file sizes. Useful for CI, performance review.\n  --nomodule [path]         Your app’s entry file for generating a <script nomodule> bundle\n  --nomodule-output [path]  Filename for nomodule output (default: 'app.nomodule.js')\n    ${chalk.bold('Advanced:')}\n  --external-package [val]  Internal use only, may be removed at any time.\n    `.trim());\n}\nasync function generateHashFromFile(targetLoc) {\n    const longHash = await hasha.fromFile(targetLoc, { algorithm: 'md5' });\n    return longHash?.slice(0, 10);\n}\nfunction formatInstallResults(skipFailures) {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return chalk.green(d);\n        }\n        if (result === 'ASSET') {\n            return chalk.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return skipFailures ? chalk.dim(d) : chalk.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\nfunction logError(msg) {\n    if (!spinnerHasError) {\n        spinner.stopAndPersist({ symbol: chalk.cyan('⠼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(chalk.red(msg));\n    spinner.fail();\n}\nfunction logUpdate(msg) {\n    spinner.text = banner + msg;\n}\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add common, well-used non-esm packages here so that Rollup doesn't die trying to analyze them.\nconst PACKAGES_TO_AUTO_DETECT_EXPORTS = [\n    path.join('react', 'index.js'),\n    path.join('react-dom', 'index.js'),\n    'react-is',\n    'prop-types',\n    'scheduler',\n    'rxjs',\n    'exenv',\n    'body-scroll-lock',\n];\nfunction detectExports(filePath) {\n    try {\n        const fileLoc = require.resolve(filePath, { paths: [cwd] });\n        if (fs.existsSync(fileLoc)) {\n            return Object.keys(require(fileLoc)).filter(e => e[0] !== '_');\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep, isExplicit) {\n    // if dep includes a file extension, check that dep isn't a package before returning\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        throw new ErrorWithHint(`\"${dep}\" not found. Have you installed the package via npm?`, depManifestLoc && chalk.italic(depManifestLoc));\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'] ||\n                foundEntrypoint;\n    }\n    // If the package was a part of the explicit whitelist, fallback to it's main CJS entrypoint.\n    if (!foundEntrypoint && isExplicit) {\n        foundEntrypoint = depManifest.main || 'index.js';\n    }\n    if ((dep === 'react' || dep === 'react-dom') &&\n        (!foundEntrypoint || foundEntrypoint === 'index.js')) {\n        throw new ErrorWithHint(chalk.bold(`Dependency \"${dep}\" has no native \"module\" entrypoint.`) +\n            `\n  To continue, install our drop-in, ESM-ready builds of \"react\" & \"react-dom\" to your project:\n    npm: npm install react@npm:@pika/react react-dom@npm:@pika/react-dom\n    yarn: yarn add react@npm:@pika/react react-dom@npm:@pika/react-dom`, chalk.italic(`See ${chalk.underline('https://www.snowpack.dev/#react')} for more info.`));\n    }\n    if (!foundEntrypoint) {\n        throw new ErrorWithHint(`dependency \"${dep}\" has no native \"module\" entrypoint.`, chalk.italic(`Tip: Find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    return {\n        type: 'JS',\n        loc: path.join(depManifestLoc, '..', foundEntrypoint),\n    };\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nexport async function install(installTargets, { hasBrowserlistConfig, isExplicit, lockfile }, config) {\n    const { dedupe, namedExports, source, installOptions: { babel: isBabel, dest: destLoc, hash: useHash, externalPackage: externalPackages, nomodule, nomoduleOutput, optimize: isOptimized, sourceMap, strict: isStrict, stat: withStats, }, rollup: userDefinedRollup, } = config;\n    const knownNamedExports = { ...namedExports };\n    for (const filePath of PACKAGES_TO_AUTO_DETECT_EXPORTS) {\n        knownNamedExports[filePath] = knownNamedExports[filePath] || detectExports(filePath) || [];\n    }\n    if (source === 'local' && !fs.existsSync(path.join(cwd, 'node_modules'))) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return;\n    }\n    const allInstallSpecifiers = new Set(installTargets.map(dep => dep.specifier).sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = !isExplicit;\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${targetName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults(skipFailures));\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier, isExplicit);\n            if (targetType === 'JS') {\n                const hashQs = useHash ? `?rev=${await generateHashFromFile(targetLoc)}` : '';\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}.js${hashQs}`;\n                installTargetsMap[targetLoc] = installTargets.filter(t => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults(skipFailures));\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults(skipFailures));\n            if (skipFailures && !ALWAYS_SHOW_ERRORS.has(installSpecifier)) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return false;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(chalk.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n        return false;\n    }\n    const inputOptions = {\n        input: installEntrypoints,\n        external: externalPackages,\n        plugins: [\n            rollupPluginEntrypointAlias({ cwd }),\n            source === 'pika' && rollupPluginDependencyCache({ log: url => logUpdate(chalk.dim(url)) }),\n            !isStrict &&\n                rollupPluginReplace({\n                    'process.env.NODE_ENV': isOptimized ? '\"production\"' : '\"development\"',\n                }),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', !isStrict && 'main'].filter(isTruthy),\n                modulesOnly: isStrict,\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: false,\n                dedupe,\n            }),\n            !isStrict &&\n                rollupPluginJson({\n                    preferConst: true,\n                    indent: '  ',\n                    compact: isOptimized,\n                    namedExports: true,\n                }),\n            !isStrict &&\n                rollupPluginCommonjs({\n                    extensions: ['.js', '.cjs'],\n                    namedExports: knownNamedExports,\n                }),\n            !!isBabel &&\n                rollupPluginBabel({\n                    compact: false,\n                    babelrc: false,\n                    configFile: false,\n                    presets: [\n                        [\n                            babelPresetEnv,\n                            {\n                                modules: false,\n                                targets: hasBrowserlistConfig\n                                    ? undefined\n                                    : '>0.75%, not ie 11, not UCAndroid >0, not OperaMini all',\n                            },\n                        ],\n                    ],\n                }),\n            !!isOptimized && rollupPluginTreeshakeInputs(installTargets),\n            !!isOptimized && rollupPluginTerser(),\n            !!withStats && rollupPluginDependencyStats(info => (dependencyStats = info)),\n            ...userDefinedRollup.plugins,\n        ],\n        onwarn(warning, warn) {\n            if (warning.code === 'UNRESOLVED_IMPORT') {\n                logError(`'${warning.source}' is imported by '${warning.importer}', but could not be resolved.`);\n                if (isNodeBuiltin(warning.source)) {\n                    console.log(chalk.dim(`  '${warning.source}' is a Node.js builtin module that won't exist in the browser.`));\n                    console.log(chalk.dim(`  Find a more web-friendly alternative, or add the \"rollup-plugin-node-polyfills\" plugin to your Snowpack config file.`));\n                }\n                else {\n                    console.log(chalk.dim(`  Make sure that the package is installed and that the file exists.`));\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap ?? isOptimized,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate('');\n            await packageBundle.write(outputOptions);\n        }\n        catch (err) {\n            const { loc } = err;\n            if (!loc || !loc.file) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on error. Because of that, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` has all the information that we need.\n            const failedExtension = path.extname(loc.file);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension];\n            if (!suggestion) {\n                throw err;\n            }\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = loc.file.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n            logError(`${chalk.bold('snowpack')} could not import ${fileName}. ${suggestion}`);\n            return;\n        }\n    }\n    if (nomodule) {\n        const nomoduleStart = Date.now();\n        function rollupResolutionHelper() {\n            return {\n                name: 'rename-import-plugin',\n                resolveId(source) {\n                    // resolve from import map\n                    if (importMap.imports[source]) {\n                        return importMap.imports[source];\n                    }\n                    // resolve web_modules\n                    if (source.includes('/web_modules/')) {\n                        const suffix = source.split('/web_modules/')[1];\n                        return { id: path.join(destLoc, suffix) };\n                    }\n                    // null means try to resolve as-is\n                    return null;\n                },\n            };\n        }\n        try {\n            const noModuleBundle = await rollup({\n                input: path.resolve(cwd, nomodule),\n                inlineDynamicImports: true,\n                plugins: [...inputOptions.plugins, rollupResolutionHelper()],\n            });\n            await noModuleBundle.write({\n                file: path.resolve(destLoc, nomoduleOutput),\n                format: 'iife',\n                name: 'App',\n            });\n            const nomoduleEnd = Date.now() - nomoduleStart;\n            spinner.info(`${chalk.bold('snowpack')} bundled your application for legacy browsers: ${nomoduleOutput} ${chalk.dim(`[${(nomoduleEnd / 1000).toFixed(2)}s]`)}`);\n        }\n        catch (err) {\n            spinner.warn(`${chalk.bold('snowpack')} encountered an error bundling for legacy browsers: ${err.message}`);\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    Object.entries(assetEntrypoints).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return true;\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, { array: ['exclude', 'externalPackage'] });\n    // if printing help, stop here\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(`${chalk.yellow('ℹ')} clearing CDN cache...`);\n        await clearCache();\n    }\n    // load config\n    const { config, errors } = loadConfig(cliFlags);\n    // handle config errors (if any)\n    if (Array.isArray(errors) && errors.length) {\n        errors.forEach(logError);\n        process.exit(0);\n    }\n    if (cliFlags.source || config.source === 'pika') {\n        console.log(`${chalk.yellow('ℹ')} \"source\" configuration is still experimental. Behavior may change before the next major version...`);\n        await clearCache();\n    }\n    // load lockfile\n    let lockfile = await readLockfile(cwd);\n    let newLockfile = null;\n    const { installOptions: { clean, dest, exclude, include }, webDependencies, source, } = config;\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(chalk.red('[ERROR] package.json required but no file was found.'));\n        process.exit(0);\n    }\n    const implicitDependencies = [\n        ...Object.keys(pkgManifest.peerDependencies || {}),\n        ...Object.keys(pkgManifest.dependencies || {}),\n    ];\n    const hasBrowserlistConfig = !!pkgManifest.browserslist ||\n        !!process.env.BROWSERSLIST ||\n        fs.existsSync(path.join(cwd, '.browserslistrc')) ||\n        fs.existsSync(path.join(cwd, 'browserslist'));\n    let isExplicit = false;\n    const installTargets = [];\n    if (webDependencies) {\n        isExplicit = true;\n        installTargets.push(...scanDepList(webDependencies, cwd));\n    }\n    if (include) {\n        isExplicit = true;\n        installTargets.push(...(await scanImports({ include, exclude })));\n    }\n    if (!webDependencies && !include) {\n        installTargets.push(...scanDepList(implicitDependencies, cwd));\n    }\n    if (installTargets.length === 0) {\n        logError('Nothing to install.');\n        return;\n    }\n    spinner.start();\n    const startTime = Date.now();\n    if (source === 'pika') {\n        newLockfile = await resolveTargetsFromRemoteCDN(installTargets, lockfile, pkgManifest, config);\n    }\n    if (clean) {\n        rimraf.sync(dest);\n    }\n    await mkdirp(dest);\n    const finalResult = await install(installTargets, { hasBrowserlistConfig, isExplicit, lockfile: newLockfile }, config).catch(err => {\n        err.loc && console.log('\\n' + chalk.red.bold(`✘ ${err.loc.file}`));\n        throw err;\n    });\n    if (finalResult) {\n        spinner.succeed(chalk.bold(`snowpack`) +\n            ` installed: ` +\n            formatInstallResults(!isExplicit) +\n            '.' +\n            chalk.dim(` [${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n        if (!!dependencyStats) {\n            console.log(printStats(dependencyStats));\n        }\n    }\n    if (newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), newLockfile);\n    }\n    // If an error happened, set the exit code so that programmatic usage of the CLI knows.\n    // We were seeing race conditions here, so add a little buffer.\n    if (spinnerHasError) {\n        setTimeout(() => {\n            spinner.warn(chalk(`Finished with warnings.`));\n            process.exitCode = 1;\n        }, 20);\n    }\n}\n"],"names":["CONFIG_NAME","DEFAULT_CONFIG","source","dedupe","installOptions","clean","hash","dest","exclude","externalPackage","nomoduleOutput","optimize","remoteUrl","stat","strict","rollup","plugins","configSchema","type","properties","webDependencies","items","namedExports","additionalProperties","babel","include","nomodule","remotePackage","sourceMap","oneOf","expandCliFlags","flags","help","version","result","normalizeDest","config","path","resolve","process","cwd","loadConfig","cliConfig","explorerSync","cosmiconfigSync","searchPlaces","stopDir","dirname","errors","load","push","search","isEmpty","merge","validation","validate","allowUnknownAttributes","propertyName","mergedConfig","map","msg","basename","filepath","toString","PIKA_CDN","CACHE_DIR","cachedir","RESOURCE_CACHE","join","HAS_CDN_HASH_REGEX","readLockfile","lockfileContents","fs","readFileSync","encoding","err","JSON","parse","writeLockfile","loc","importMap","writeFileSync","stringify","undefined","fetchCDNResource","resourceUrl","startsWith","got","headers","throwHttpErrors","isTruthy","item","Boolean","resolveDependencyManifest","dep","depManifest","require","paths","code","message","includes","fullPath","searchPath","sep","replace","indexOfSearch","lastIndexOf","manifestPath","substring","length","manifestStr","MISSING_PLUGIN_SUGGESTIONS","resolveDependency","installSpecifier","packageSemver","lockfile","validatePackageName","validForNewPackages","installUrl","imports","console","warn","Error","test","cachedResult","cacache","get","info","catch","metadata","pinnedUrl","statusCode","body","_pinnedUrl","put","resolveTargetsFromRemoteCDN","installTargets","pkgManifest","downloadQueue","PQueue","concurrency","newLockfile","allInstallSpecifiers","Set","specifier","installSemver","dependencies","devDependencies","peerDependencies","add","resolvedUrl","onIdle","clearCache","rm","all","CACHED_FILE_ID_PREFIX","rollupPluginDependencyCache","log","name","resolveId","importer","cacheKey","response","packageName","split","skipSelf","then","resolved","finalResult","id","data","IS_DEEP_PACKAGE_IMPORT","rollupPluginEntrypointAlias","packageScope","match","packageFullName","manifest","needsAlias","module","posix","browser","main","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","bundle","fileName","Object","keys","filePath","existsSync","size","statSync","compareDependencies","files","contents","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","options","dir","writeBundle","directDependencies","commonDependencies","assetOrChunk","entries","raw","Buffer","isBuffer","from","rollupPluginTreeshakeInputs","allImports","installTargetsByFile","inputOptions","input","key","val","filter","imp","some","fileLoc","treeshakeSummary","reduce","summary","default","namespace","named","uniqueNamedImports","normalizedFileLoc","win32","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","HAS_NAMED_IMPORTS_REGEX","SPLIT_NAMED_IMPORTS_REGEX","DEFAULT_IMPORT_REGEX","stripJsExtension","createInstallTarget","removeSpecifierQueryString","queryStringIndex","indexOf","getWebModuleSpecifierFromCode","d","s","e","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","importStatement","ss","se","dynamicImport","defaultImport","namespaceImport","namedImports","trim","getInstallTargetsForFile","scanDepList","depList","nodeModulesLoc","nodePath","whitelistItem","glob","hasMagic","sync","nodir","flat","concat","scanImports","initESModuleLexer","includeFiles","ignore","endsWith","sort","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","chalk","padEnd","formatDelta","formatFileInfo","filename","stats","isLastFile","lineGlyph","dim","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","index","printStats","dependencyStats","output","allDirect","allCommon","maxFileNameLength","max","bold","underline","values","ALWAYS_SHOW_ERRORS","banner","installResults","spinner","ora","spinnerHasError","printHelp","generateHashFromFile","targetLoc","longHash","hasha","fromFile","algorithm","slice","formatInstallResults","skipFailures","green","yellow","red","logError","stopAndPersist","symbol","cyan","fail","logUpdate","text","ErrorWithHint","constructor","hint","PACKAGES_TO_AUTO_DETECT_EXPORTS","detectExports","resolveWebDependency","isExplicit","extname","isJSFile","depManifestLoc","italic","foundEntrypoint","getWebDependencyName","install","hasBrowserlistConfig","isBabel","destLoc","useHash","externalPackages","isOptimized","isStrict","withStats","userDefinedRollup","knownNamedExports","installEntrypoints","assetEntrypoints","installTargetsMap","targetName","targetType","hashQs","t","has","setTimeout","external","url","rollupPluginReplace","rollupPluginNodeResolve","mainFields","modulesOnly","extensions","preferBuiltins","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","rollupPluginBabel","babelrc","configFile","presets","babelPresetEnv","modules","targets","rollupPluginTerser","onwarn","warning","isNodeBuiltin","outputOptions","format","sourcemap","exports","chunkFileNames","packageBundle","write","file","failedExtension","suggestion","nomoduleStart","Date","now","rollupResolutionHelper","suffix","noModuleBundle","inlineDynamicImports","nomoduleEnd","toFixed","forEach","assetName","assetLoc","mkdirp","copyFileSync","cli","args","cliFlags","yargs","array","exit","reload","Array","isArray","implicitDependencies","browserslist","env","BROWSERSLIST","start","startTime","rimraf","succeed","exitCode"],"mappings":"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"}